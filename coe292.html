<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COE 292 â€” Introduction to AI - Topic 2 Interactive Studio</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@11/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>
    <style>
        .custom-card {
            background: white;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .custom-button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .custom-button-primary {
            background: #3b82f6;
            color: white;
        }
        .custom-button-primary:hover {
            background: #2563eb;
        }
        .custom-button-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        .custom-button-secondary:hover {
            background: #e5e7eb;
        }
        .custom-input {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
        }
        .custom-tabs-list {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            background: #f9fafb;
            padding: 0.25rem;
            border-radius: 1rem;
        }
        .custom-tab {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            text-align: center;
            font-weight: 500;
        }
        .custom-tab.active {
            background: white;
            color: #3b82f6;
        }
        .custom-tab:not(.active) {
            color: #6b7280;
        }
        .custom-tab:not(.active):hover {
            background: #e5e7eb;
        }
        @media (max-width: 768px) {
            .custom-tabs-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { motion } = window.FramerMotion;
        const { Brain, Hammer, Trees, GitBranch, Play, Pause, RotateCcw, StepForward, CheckCircle2, CircleHelp } = window.LucideReact;

        // Utility functions
        const cn = (...cls) => cls.filter(Boolean).join(" ");

        function useInterval(callback, delay) {
            const savedRef = useRef(callback);
            useEffect(() => { savedRef.current = callback; }, [callback]);
            useEffect(() => {
                if (delay === null) return;
                const id = setInterval(() => savedRef.current(), delay);
                return () => clearInterval(id);
            }, [delay]);
        }

        function shuffle(arr, rng) {
            const a = [...arr];
            const R = rng ?? Math.random;
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(R() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        function evaluate(node) {
            if (!node || !node.children || node.children.length === 0) return !!node?.done;
            if (node.type === "AND") return node.children.every(c => evaluate(c));
            return node.children.some(c => evaluate(c));
        }

        function hanoiMoves(n, from, to, aux, acc = []) {
            if (n <= 0) return acc;
            hanoiMoves(n - 1, from, aux, to, acc);
            acc.push([from, to]);
            hanoiMoves(n - 1, aux, to, from, acc);
            return acc;
        }

        // Components
        function Header() {
            return (
                <div className="flex items-center justify-between mb-6">
                    <div className="flex items-center gap-3">
                        <motion.div 
                            initial={{ rotate: -10, scale: 0.9 }} 
                            animate={{ rotate: 0, scale: 1 }} 
                            className="p-2 rounded-2xl bg-gradient-to-br from-indigo-500 to-violet-500 text-white shadow"
                        >
                            <Brain className="w-6 h-6" />
                        </motion.div>
                        <div>
                            <h1 className="text-2xl md:text-3xl font-bold leading-tight">Topic 2 Playground</h1>
                            <p className="text-sm text-gray-600">Goal Trees & Problem Solving â€” COE 292</p>
                        </div>
                    </div>
                    <div className="hidden md:flex items-center gap-2 text-xs text-gray-600">
                        <span className="px-2 py-1 rounded-full bg-gray-200">Interactive</span>
                        <span className="px-2 py-1 rounded-full bg-gray-200">No math panic ðŸ˜Š</span>
                    </div>
                </div>
            );
        }

        function LearningGoals() {
            const items = [
                { icon: <Trees className="w-4 h-4" />, text: "Read and build AND/OR goal trees" },
                { icon: <GitBranch className="w-4 h-4" />, text: "Reduce a problem into subgoals (problem reduction)" },
                { icon: <Hammer className="w-4 h-4" />, text: "Apply recursion with base/recursive cases" },
                { icon: <CircleHelp className="w-4 h-4" />, text: "Contrast naÃ¯ve Generate & Test vs. simple pruning" },
            ];

            return (
                <div className="custom-card p-6">
                    <h2 className="text-lg font-semibold mb-4">What you will practice</h2>
                    <div className="grid sm:grid-cols-2 gap-2 mb-3">
                        {items.map((item, i) => (
                            <div key={i} className="flex items-center gap-2 p-2 rounded-xl bg-gray-100">
                                <span className="text-gray-600">{item.icon}</span>
                                <span>{item.text}</span>
                            </div>
                        ))}
                    </div>
                    <p className="text-sm text-gray-600">
                        This playground follows the structure and vocabulary used in the course slides for Topic 2 (Goal Trees & Problem Solving).
                    </p>
                </div>
            );
        }

        function Overview() {
            return (
                <div className="custom-card p-6">
                    <h2 className="text-lg font-semibold mb-4">Cheatâ€‘Sheet (Topic 2)</h2>
                    <div className="text-sm space-y-2">
                        <ul className="list-disc ml-5 space-y-2">
                            <li><strong>State-space problem:</strong> specify initial state, goal state, all possible states, and constraints before search.</li>
                            <li><strong>Goal tree:</strong> hierarchical breakdown of a goal into subgoals; leaves are terminal subgoals. <em>Note:</em> some leaves may be unused in the final solution.</li>
                            <li><strong>AND node vs OR node:</strong> AND = all children must be achieved; OR = any one child suffices.</li>
                            <li><strong>Hanoi reduction:</strong> <code>nAC â†’ (nâˆ’1)AB</code>, <code>1AC</code>, <code>(nâˆ’1)BC</code> (AND).</li>
                            <li><strong>Recursion:</strong> base case stops; recursive case reduces to a smaller instance.</li>
                            <li><strong>Generate & Test:</strong> generate candidates then test; pruning improves efficiency.</li>
                        </ul>
                        <p className="text-gray-600">Tip: When stuck, sketch an AND/OR structure and mark which leaves are already satisfied.</p>
                    </div>
                </div>
            );
        }

        function Hanoi() {
            const canvasRef = useRef(null);
            const [n, setN] = useState(3);
            const [pegs, setPegs] = useState({ A: [], B: [], C: [] });
            const [moves, setMoves] = useState([]);
            const [idx, setIdx] = useState(0);
            const [playing, setPlaying] = useState(false);
            const [delay, setDelay] = useState(400);
            const [selected, setSelected] = useState(null);
            const [manualCount, setManualCount] = useState(0);
            const [statusMsg, setStatusMsg] = useState("");
            const [showHints, setShowHints] = useState(true);
            const [history, setHistory] = useState([]);
            const [invalidMove, setInvalidMove] = useState(null);
            const [mode, setMode] = useState('select');

            const init = (disks) => {
                const initial = { A: Array.from({ length: disks }, (_, i) => disks - i), B: [], C: [] };
                setPegs(initial);
                setMoves(hanoiMoves(disks, "A", "C", "B"));
                setIdx(0);
                setPlaying(false);
                setSelected(null);
                setManualCount(0);
                setHistory([]);
                setStatusMsg("");
                setInvalidMove(null);
                setMode('select');
            };

            useEffect(() => { init(n); }, [n]);

            const minMoves = Math.pow(2, n) - 1;
            const isSolved = pegs.C?.length === n;
            const initialA = useMemo(() => Array.from({ length: n }, (_, i) => n - i), [n]);
            const isInitial = useMemo(() => (
                JSON.stringify(pegs.A) === JSON.stringify(initialA) && 
                (pegs.B?.length ?? 0) === 0 && 
                (pegs.C?.length ?? 0) === 0 && 
                idx === 0
            ), [pegs, initialA, idx]);

            const draw = () => {
                const cvs = canvasRef.current;
                if (!cvs) return;
                const ctx = cvs.getContext('2d');
                if (!ctx) return;
                const W = cvs.width, H = cvs.height;
                ctx.clearRect(0, 0, W, H);

                // Base
                ctx.fillStyle = '#ddd';
                ctx.fillRect(20, H - 30, W - 40, 10);

                const pegX = [W * 0.2, W * 0.5, W * 0.8];
                const pegKeys = ['A', 'B', 'C'];

                // Pegs
                ctx.fillStyle = '#888';
                pegX.forEach(x => { ctx.fillRect(x - 4, H - 160, 8, 130); });

                // Labels
                ctx.fillStyle = '#444';
                ctx.font = '12px system-ui, sans-serif';
                pegKeys.forEach((k, i) => { const x = pegX[i]; ctx.fillText(k, x - 3, H - 40); });

                // Hints
                const top = (arr) => arr[arr.length - 1];
                const legalTargetsFrom = (src) => pegKeys.filter(dst => dst !== src && (pegs[dst].length === 0 || top(pegs[dst]) > top(pegs[src])));
                const legalSources = pegKeys.filter(src => pegs[src].length > 0 && legalTargetsFrom(src).length > 0);

                // Highlight invalid move
                if (invalidMove) {
                    const i = pegKeys.indexOf(invalidMove);
                    if (i >= 0) {
                        ctx.strokeStyle = '#ef4444';
                        ctx.lineWidth = 3;
                        ctx.strokeRect(pegX[i] - 60, H - 170, 120, 150);
                    }
                }

                // Highlight selected peg or hints
                if (selected) {
                    const i = pegKeys.indexOf(selected);
                    if (i >= 0) {
                        ctx.strokeStyle = '#10b981';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(pegX[i] - 60, H - 170, 120, 150);
                    }
                    if (showHints) {
                        ctx.strokeStyle = '#fbbf24';
                        ctx.lineWidth = 2;
                        legalTargetsFrom(selected).forEach(dst => {
                            const j = pegKeys.indexOf(dst);
                            ctx.strokeRect(pegX[j] - 60, H - 170, 120, 150);
                        });
                    }
                } else if (showHints) {
                    ctx.strokeStyle = '#fbbf24';
                    ctx.lineWidth = 2;
                    legalSources.forEach(src => {
                        const i = pegKeys.indexOf(src);
                        ctx.strokeRect(pegX[i] - 60, H - 170, 120, 150);
                    });
                }

                // Draw disks
                const maxWidth = 120;
                const diskHeight = 14;
                const colorFor = (d) => `hsl(${(d*40)%360} 65% 55%)`;

                pegKeys.forEach((k, i) => {
                    const stack = pegs[k];
                    stack.forEach((d, idxOnPeg) => {
                        const w = 30 + (d / n) * maxWidth;
                        const x = pegX[i];
                        const y = H - 40 - idxOnPeg * (diskHeight + 2);
                        ctx.fillStyle = colorFor(d);
                        ctx.fillRect(x - w/2, y - diskHeight, w, diskHeight);
                        ctx.fillStyle = 'rgba(255,255,255,0.25)';
                        ctx.fillRect(x - w/2, y - diskHeight, w, 2);
                    });
                });
            };

            useEffect(draw, [pegs, selected, n, showHints, invalidMove]);

            const stepAuto = () => {
                if (idx >= moves.length) return;
                const [from, to] = moves[idx];
                setPegs(prev => {
                    const nf = { ...prev, [from]: [...prev[from]], [to]: [...prev[to]] };
                    const disk = nf[from].pop();
                    nf[to].push(disk);
                    return nf;
                });
                setIdx(i => i + 1);
            };

            const handleToggleAuto = () => {
                if (!playing) {
                    if (!isInitial) {
                        init(n);
                        setStatusMsg("Auto-solve starts from the initial state.");
                        setMode('auto');
                        setPlaying(true);
                        return;
                    }
                    setMode('auto');
                }
                setPlaying(p => !p);
            };

            useInterval(() => { 
                if (playing) { 
                    if (idx < moves.length) stepAuto(); 
                    else setPlaying(false); 
                } 
            }, playing ? delay : null);

            const pegFromX = (xCanvas) => {
                const cvs = canvasRef.current;
                if (!cvs) return null;
                const W = cvs.width;
                const pegCenters = [W*0.2, W*0.5, W*0.8];
                const keys = ['A', 'B', 'C'];
                let best = null, bestDist = Infinity;
                pegCenters.forEach((px, i) => { 
                    const d = Math.abs(px - xCanvas); 
                    if (d < bestDist) { 
                        bestDist = d; 
                        best = keys[i]; 
                    } 
                });
                return best;
            };

            const handleCanvasInteraction = (clientX, currentTarget) => {
                if (mode !== 'manual') return;

                const rect = currentTarget.getBoundingClientRect();
                const scaleX = currentTarget.width / rect.width;
                const xCanvas = (clientX - rect.left) * scaleX;

                const target = pegFromX(xCanvas);
                if (!target) return;

                setInvalidMove(null);

                if (!selected) {
                    if (pegs[target].length === 0) return;
                    setSelected(target);
                    return;
                }
                if (selected === target) { setSelected(null); return; }

                const fromArr = pegs[selected];
                const toArr = pegs[target];
                if (fromArr.length === 0) { setSelected(null); return; }
                const disk = fromArr[fromArr.length - 1];
                const ok = toArr.length === 0 || toArr[toArr.length - 1] > disk;
                if (!ok) {
                    setInvalidMove(target);
                    setSelected(null);
                    return;
                }
                setPegs(prev => {
                    const snapshot = JSON.parse(JSON.stringify(prev));
                    const nf = { ...prev, [selected]: [...prev[selected]], [target]: [...prev[target]] };
                    nf[selected].pop();
                    nf[target].push(disk);
                    setHistory(h => [...h, snapshot]);
                    return nf;
                });
                setManualCount(c => c + 1);
                setSelected(null);
            };

            const onCanvasPointerDown = (e) => {
                e.preventDefault();
                handleCanvasInteraction(e.clientX, e.currentTarget);
            };

            const undo = () => {
                setHistory(h => {
                    if (h.length === 0) return h;
                    const last = h[h.length - 1];
                    setPegs(last);
                    setManualCount(c => Math.max(0, c - 1));
                    setSelected(null);
                    return h.slice(0, -1);
                });
            };

            useEffect(() => {
                if (isSolved) {
                    setPlaying(false);
                    if (manualCount > 0) {
                        setStatusMsg(manualCount === minMoves ? "Optimal solution! ðŸŽ‰" : `Solved in ${manualCount} moves (optimal is ${minMoves}).`);
                        setTimeout(() => setMode('select'), 2000);
                    }
                }
            }, [isSolved, manualCount, minMoves]);

            useEffect(() => {
                if (!statusMsg) return;
                const t = setTimeout(() => setStatusMsg(""), 3000);
                return () => clearTimeout(t);
            }, [statusMsg]);

            useEffect(() => {
                if (!invalidMove) return;
                const t = setTimeout(() => setInvalidMove(null), 1500);
                return () => clearTimeout(t);
            }, [invalidMove]);

            return (
                <div className="custom-card p-6">
                    <h2 className="text-lg font-semibold mb-4">Tower of Hanoi â€” Canvas Demo</h2>
                    <div className="space-y-4">
                        <div className="space-y-3">
                            <div className="flex flex-wrap items-center gap-3">
                                <label className="text-sm" htmlFor="disks">Disks:</label>
                                <input 
                                    id="disks" 
                                    type="number" 
                                    value={n} 
                                    min={1} 
                                    max={8} 
                                    onChange={(e) => setN(Math.max(1, Math.min(8, Number(e.target.value) || 1)))} 
                                    className="custom-input w-20" 
                                />
                                <button 
                                    className="custom-button custom-button-secondary" 
                                    onClick={() => init(n)}
                                >
                                    <RotateCcw className="w-4 h-4 mr-1 inline" /> Reset
                                </button>
                            </div>

                            {mode === 'select' && (
                                <div className="p-4 rounded-xl border-2 border-dashed border-gray-300 text-center">
                                    <p className="text-sm text-gray-600 mb-3">Choose how to solve the Tower of Hanoi:</p>
                                    <div className="flex flex-wrap justify-center gap-2">
                                        <button 
                                            onClick={() => setMode('manual')} 
                                            className="custom-button custom-button-primary flex-1 min-w-32"
                                        >
                                            ðŸ‘¤ Manual Play
                                        </button>
                                        <button 
                                            onClick={() => setMode('auto')} 
                                            className="custom-button custom-button-secondary flex-1 min-w-32"
                                        >
                                            ðŸ¤– Auto Solve
                                        </button>
                                    </div>
                                </div>
                            )}

                            {mode === 'manual' && (
                                <div className="flex flex-wrap items-center gap-2">
                                    <span className="text-sm font-medium">ðŸ‘¤ Manual Mode</span>
                                    <button 
                                        className="custom-button custom-button-secondary" 
                                        onClick={undo} 
                                        disabled={history.length === 0}
                                    >
                                        Undo
                                    </button>
                                    <button 
                                        className="custom-button custom-button-secondary" 
                                        onClick={() => setMode('select')}
                                    >
                                        Back
                                    </button>
                                </div>
                            )}

                            {mode === 'auto' && (
                                <div className="flex flex-wrap items-center gap-3">
                                    <span className="text-sm font-medium">ðŸ¤– Auto Mode</span>
                                    <div className="flex items-center gap-2">
                                        <button 
                                            className="custom-button custom-button-secondary" 
                                            onClick={handleToggleAuto} 
                                            disabled={idx >= moves.length}
                                        >
                                            {playing ? <Pause className="w-4 h-4 mr-1 inline" /> : <Play className="w-4 h-4 mr-1 inline" />} 
                                            {playing ? "Pause" : "Play"}
                                        </button>
                                        <button 
                                            className="custom-button custom-button-secondary" 
                                            onClick={stepAuto} 
                                            disabled={idx >= moves.length}
                                        >
                                            <StepForward className="w-4 h-4 mr-1 inline" /> Next Move
                                        </button>
                                        <button 
                                            className="custom-button custom-button-secondary" 
                                            onClick={() => setMode('select')}
                                        >
                                            Back
                                        </button>
                                    </div>
                                    <div className="flex items-center gap-2 ml-auto text-sm">
                                        <span>Speed</span>
                                        <input 
                                            type="range" 
                                            min={100} 
                                            max={1200} 
                                            step={50} 
                                            value={delay} 
                                            onChange={(e) => setDelay(Number(e.target.value))} 
                                        />
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="p-4 rounded-2xl bg-gray-100">
                                <canvas
                                    ref={canvasRef}
                                    width={540}
                                    height={220}
                                    style={{ touchAction: 'none' }}
                                    onPointerDown={onCanvasPointerDown}
                                    className="w-full h-auto bg-white rounded-xl shadow-inner"
                                />
                                <div className="text-xs text-gray-600 mt-2">
                                    {mode === 'select' && "Choose Manual Play or Auto Solve above to begin."}
                                    {mode === 'manual' && "Tap a source peg, then a destination peg to make a legal move."}
                                    {mode === 'auto' && "Watch the automatic solution or step through it manually."}
                                </div>
                            </div>

                            <div className="space-y-3">
                                <div className="custom-card p-4">
                                    <h3 className="text-base font-semibold mb-2">Status</h3>
                                    <div className="text-sm space-y-2">
                                        <div className="flex justify-between"><span>Auto step:</span><span>{idx} / {moves.length} (optimal {minMoves})</span></div>
                                        <div className="flex justify-between"><span>Manual moves:</span><span>{manualCount}</span></div>
                                        {statusMsg && <div className="text-xs rounded-md bg-emerald-50 text-emerald-700 px-2 py-1">{statusMsg}</div>}
                                        <div className="border-t pt-2">
                                            <div className="flex items-center gap-2 mb-2">
                                                <input 
                                                    id="hints" 
                                                    type="checkbox" 
                                                    checked={showHints} 
                                                    onChange={(e) => setShowHints(e.target.checked)} 
                                                />
                                                <label htmlFor="hints" className="text-sm">Show hints (legal pegs highlighted)</label>
                                            </div>
                                            <p className="text-gray-600 text-sm">Recursive plan (problem reduction):</p>
                                            <div className="font-mono text-xs bg-gray-200 p-2 rounded-xl mt-1">
                                                Move n disks Aâ†’C via B:<br/>
                                                1) Move n-1 Aâ†’B<br/>
                                                2) Move 1 Aâ†’C<br/>
                                                3) Move n-1 Bâ†’C
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function App() {
            const [activeTab, setActiveTab] = useState('overview');

            const tabs = [
                { id: 'overview', label: 'Overview' },
                { id: 'hanoi', label: 'Hanoi' },
            ];

            return (
                <div className="p-4 md:p-8 max-w-6xl mx-auto">
                    <Header />
                    
                    <div className="w-full">
                        <div className="custom-tabs-list mb-4">
                            {tabs.map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`custom-tab ${activeTab === tab.id ? 'active' : ''}`}
                                >
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                        
                        <div className="mt-4">
                            {activeTab === 'overview' && (
                                <div className="grid lg:grid-cols-2 gap-4">
                                    <LearningGoals />
                                    <Overview />
                                </div>
                            )}
                            {activeTab === 'hanoi' && <Hanoi />}
                        </div>
                    </div>

                    <footer className="mt-6 text-xs text-gray-600 text-center">
                        Built for COE 292 â€” Topic 2 (Goal Trees & Problem Solving). Use it as a study companion alongside the course slides.
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>